<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerfWatcher Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .metrics {
            background: #fff;
            padding: 15px;
            border-left: 4px solid #007cba;
            margin: 10px 0;
        }

        .metric-item {
            margin: 5px 0;
            padding: 5px;
            background: #f5f5f5;
            border-radius: 3px;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        h1 {
            color: #333;
        }

        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
        }

        button:hover {
            background: #005a8a;
        }
    </style>
</head>
<body>
    <h1>PerfWatcher Demo</h1>

    <div class="container">
        <h2>Performance Monitoring Demo</h2>
        <p>This page demonstrates the PerfWatcher library in action. Metrics will be collected automatically when the page loads.</p>

        <button onclick="showMetrics()">Show Current Metrics</button>
        <button onclick="clearMetrics()">Clear Display</button>
        <button onclick="downloadJSON()">Export JSON</button>
        <button onclick="downloadCSV()">Export CSV</button>
    </div>

    <div id="metrics-display" class="container" style="display: none;">
        <h3>Performance Metrics</h3>
        <div id="navigation-metrics" class="metrics">
            <h4>Navigation Timing</h4>
            <div id="nav-content" class="loading">Loading navigation metrics...</div>
        </div>

        <div id="resource-metrics" class="metrics">
            <h4>Resource Loading</h4>
            <div id="resource-content" class="loading">Loading resource metrics...</div>
        </div>
    </div>

    <script src="src/perf-watcher.js"></script>
    <script>
        // Initialize PerfWatcher
        const monitor = new PerfWatcher({
            enableConsoleOutput: true,
            trackNavigation: true,
            trackResources: true
        });

        function showMetrics() {
            const metricsDisplay = document.getElementById('metrics-display');
            const metrics = monitor.getMetrics();

            // Show navigation metrics
            const navContent = document.getElementById('nav-content');
            if (metrics.navigation) {
                navContent.innerHTML = `
                    <div class="metric-item">DOM Content Loaded: ${metrics.navigation.domContentLoaded.toFixed(2)}ms</div>
                    <div class="metric-item">Load Complete: ${metrics.navigation.loadComplete.toFixed(2)}ms</div>
                    <div class="metric-item">DOM Interactive: ${metrics.navigation.domInteractive.toFixed(2)}ms</div>
                    <div class="metric-item">Total Load Time: ${metrics.navigation.totalLoadTime.toFixed(2)}ms</div>
                `;
            } else {
                navContent.innerHTML = '<div class="loading">Navigation metrics not yet available</div>';
            }

            // Show resource metrics
            const resourceContent = document.getElementById('resource-content');
            if (metrics.resources && metrics.resources.length > 0) {
                let resourceHtml = '';
                metrics.resources.forEach((resource, index) => {
                    const fileName = resource.name.split('/').pop() || resource.name;
                    resourceHtml += `
                        <div class="metric-item">
                            <strong>${fileName}</strong> (${resource.type})<br>
                            Duration: ${resource.duration.toFixed(2)}ms, Size: ${resource.size} bytes
                        </div>
                    `;
                });
                resourceContent.innerHTML = resourceHtml;
            } else {
                resourceContent.innerHTML = '<div class="loading">Resource metrics not yet available</div>';
            }

            metricsDisplay.style.display = 'block';
        }

        function clearMetrics() {
            const metricsDisplay = document.getElementById('metrics-display');
            metricsDisplay.style.display = 'none';
        }

        function downloadJSON() {
            monitor.downloadJSON();
        }

        function downloadCSV() {
            monitor.downloadCSV();
        }

        // Auto-show metrics after page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                showMetrics();
            }, 1500);
        });
    </script>
</body>
</html>