<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerfWatcher Demo</title>
    <link rel="stylesheet" href="styles/demo.css">
</head>
<body>
    <h1>PerfWatcher Demo</h1>

    <div class="container">
        <h2>Performance Monitoring Demo</h2>
        <p>This page demonstrates the PerfWatcher library in action. Metrics will be collected automatically when the page loads.</p>

        <div class="button-group">
            <button onclick="showMetrics()">Show Current Metrics</button>
            <button onclick="clearMetrics()">Clear Display</button>
            <button onclick="downloadJSON()">Export JSON</button>
            <button onclick="downloadCSV()">Export CSV</button>
            <button onclick="testCustomEvent()">Test Custom Event</button>
        </div>
    </div>

    <div id="metrics-display" class="container" style="display: none;">
        <h3>Performance Metrics</h3>
        <div id="navigation-metrics" class="metrics">
            <h4>Navigation Timing</h4>
            <div id="nav-content" class="loading">Loading navigation metrics...</div>
        </div>

        <div id="resource-metrics" class="metrics">
            <h4>Resource Loading</h4>
            <div id="resource-content" class="loading">Loading resource metrics...</div>
        </div>

        <div id="memory-metrics" class="metrics">
            <h4>Memory Usage</h4>
            <div id="memory-content" class="loading">Loading memory metrics...</div>
        </div>

        <div id="custom-metrics" class="metrics">
            <h4>Custom Events</h4>
            <div id="custom-content" class="loading">No custom events tracked yet</div>
        </div>
    </div>

    <script src="src/perf-watcher.js"></script>
    <script>
        // Initialize PerfWatcher
        const monitor = new PerfWatcher({
            enableConsoleOutput: true,
            trackNavigation: true,
            trackResources: true,
            trackMemory: true,
            trackCustomEvents: true
        });

        function showMetrics() {
            const metricsDisplay = document.getElementById('metrics-display');
            const metrics = monitor.getMetrics();

            // Show navigation metrics
            const navContent = document.getElementById('nav-content');
            if (metrics.navigation) {
                navContent.innerHTML = `
                    <div class="metric-item">DOM Content Loaded: ${metrics.navigation.domContentLoaded.toFixed(2)}ms</div>
                    <div class="metric-item">Load Complete: ${metrics.navigation.loadComplete.toFixed(2)}ms</div>
                    <div class="metric-item">DOM Interactive: ${metrics.navigation.domInteractive.toFixed(2)}ms</div>
                    <div class="metric-item">Total Load Time: ${metrics.navigation.totalLoadTime.toFixed(2)}ms</div>
                `;
            } else {
                navContent.innerHTML = '<div class="loading">Navigation metrics not yet available</div>';
            }

            // Show resource metrics
            const resourceContent = document.getElementById('resource-content');
            if (metrics.resources && metrics.resources.length > 0) {
                let resourceHtml = '';
                metrics.resources.forEach((resource, index) => {
                    const fileName = resource.name.split('/').pop() || resource.name;
                    resourceHtml += `
                        <div class="metric-item">
                            <strong>${fileName}</strong> (${resource.type})<br>
                            Duration: ${resource.duration.toFixed(2)}ms, Size: ${resource.size} bytes
                        </div>
                    `;
                });
                resourceContent.innerHTML = resourceHtml;
            } else {
                resourceContent.innerHTML = '<div class="loading">Resource metrics not yet available</div>';
            }

            // Show memory metrics
            const memoryContent = document.getElementById('memory-content');
            if (metrics.memory) {
                const usedMB = (metrics.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                const totalMB = (metrics.memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                const limitMB = (metrics.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2);
                memoryContent.innerHTML = `
                    <div class="metric-item">Used Heap: ${usedMB} MB</div>
                    <div class="metric-item">Total Heap: ${totalMB} MB</div>
                    <div class="metric-item">Heap Limit: ${limitMB} MB</div>
                `;
            } else {
                memoryContent.innerHTML = '<div class="loading">Memory API not available in this browser</div>';
            }

            // Show custom events
            const customContent = document.getElementById('custom-content');
            if (metrics.customEvents && metrics.customEvents.length > 0) {
                let eventsHtml = '';
                metrics.customEvents.forEach((event, index) => {
                    eventsHtml += `
                        <div class="metric-item">
                            <strong>${event.name}</strong> at ${event.timestamp.toFixed(2)}ms<br>
                            ${event.data ? JSON.stringify(event.data) : 'No additional data'}
                        </div>
                    `;
                });
                customContent.innerHTML = eventsHtml;
            } else {
                customContent.innerHTML = '<div class="loading">No custom events tracked yet</div>';
            }

            metricsDisplay.style.display = 'block';
        }

        function clearMetrics() {
            const metricsDisplay = document.getElementById('metrics-display');
            metricsDisplay.style.display = 'none';
        }

        function downloadJSON() {
            monitor.downloadJSON();
        }

        function downloadCSV() {
            monitor.downloadCSV();
        }

        function testCustomEvent() {
            const eventData = {
                timestamp: Date.now(),
                userId: 'demo_user',
                action: 'test_button_click'
            };
            monitor.trackCustomEvent('demo_event', eventData);

            // Refresh display to show new event
            showMetrics();
        }

        // Auto-show metrics after page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                showMetrics();
            }, 1500);
        });
    </script>
</body>
</html>